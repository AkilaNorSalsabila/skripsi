<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pilihan Game</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/permainan.css') }}">

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body class="permainan">

  <!-- ðŸŽ§ AUDIO -->
  <audio id="instruction-audio"
         src="{{ url_for('static', filename='sounds/instruction_permainan.mp3') }}"></audio>

  <audio id="voice-sayuran"
         src="{{ url_for('static', filename='sounds/game_sayuran.mp3') }}"></audio>

  <audio id="voice-hewan"
         src="{{ url_for('static', filename='sounds/game_hewan.mp3') }}"></audio>

  <audio id="bg-music"
         src="{{ url_for('static', filename='sounds/bensound-besttime.m4a') }}"
         loop></audio>

  <!-- Dekorasi -->
  <img src="{{ url_for('static', filename='img/monyet_corner.png') }}"
       class="decor decor-left">
  <img src="{{ url_for('static', filename='img/vegetables_corner.png') }}"
       class="decor decor-right">

  <!-- Konten -->
  <div class="content">
    <h1>Pilih Menu Permainan</h1>

    <div class="menu-buttons">

      <!-- Game Sayuran -->
      <button class="game-sayuran" onclick="goGame('sayuran')">
        <img src="{{ url_for('static', filename='img/sayuran_button2.png') }}">
        <span>Sayuran</span>
      </button>

      <!-- Game Hewan -->
      <button class="game-hewan" onclick="goGame('hewan')">
        <img src="{{ url_for('static', filename='img/hewan_button2.png') }}">
        <span>Hewan</span>
      </button>

    </div>
  </div>

  <!-- Tombol Back -->
  <a href="/" class="back-button">
    <img src="{{ url_for('static', filename='img/back.png') }}">
  </a>

  <!-- ðŸ§  SCRIPT -->
  <script>
    const bgMusic = document.getElementById("bg-music");
    const instruction = document.getElementById("instruction-audio");
    
    // Ambil elemen tombol untuk dianimasikan
    const btnSayuran = document.querySelector('.game-sayuran');
    const btnHewan = document.querySelector('.game-hewan');

    const voiceMap = {
      sayuran: {
        audio: document.getElementById("voice-sayuran"),
        url: "/pilih_level"
      },
      hewan: {
        audio: document.getElementById("voice-hewan"),
        url: "/game_hewan"
      }
    };

    sessionStorage.setItem("hasStarted", "true");

    function stopAllAudio() {
      instruction.pause();
      instruction.currentTime = 0;
      // Hilangkan animasi jika ada yang masih jalan
      btnSayuran.classList.remove('btn-pulse');
      btnHewan.classList.remove('btn-pulse');

      Object.values(voiceMap).forEach(item => {
        item.audio.pause();
        item.audio.currentTime = 0;
      });
    }

    // ===== MUSIK BACKGROUND =====
    bgMusic.volume = 0.03;
    bgMusic.play().catch(()=>{});

    // ===== LOGIKA ANIMASI SAAT INSTRUKSI BERJALAN =====
    instruction.play().catch(()=>{});

    instruction.onplay = () => bgMusic.volume = 0.015;
    
    instruction.ontimeupdate = () => {
      let time = instruction.currentTime;

      // Contoh: Suara bilang "Sayuran" di detik 2 sampai 4
      if (time >= 1.5 && time <= 2.5) { 
        btnSayuran.classList.add('btn-pulse');
      } else {
        btnSayuran.classList.remove('btn-pulse');
      }

      // Contoh: Suara bilang "Hewan" di detik 5 sampai 7
      if (time >= 2.6 && time <= 3.7) { 
        btnHewan.classList.add('btn-pulse');
      } else {
        btnHewan.classList.remove('btn-pulse');
      }
    };

    instruction.onended = () => {
      bgMusic.volume = 0.03;
      btnSayuran.classList.remove('btn-pulse');
      btnHewan.classList.remove('btn-pulse');
    };

    // ===== KLIK GAME =====
    function goGame(type) {
      stopAllAudio(); 
      bgMusic.volume = 0.015;

      const activeBtn = document.querySelector(`.game-${type}`);
      if (activeBtn) activeBtn.classList.add('btn-pulse');

      const item = voiceMap[type];
      item.audio.play();

      item.audio.onended = () => {
        bgMusic.volume = 0.03;
        window.location.href = item.url;
      };
    }
  </script>

</body>
</html>
